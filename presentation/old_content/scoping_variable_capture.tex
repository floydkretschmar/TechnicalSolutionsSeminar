\begin{frame}[fragile]{Anonyme innere Klassen}{Nachteile}

    \begin{center}
        \begin{minipage}[b]{0.75\textwidth}
            \begin{block}{Instanziierung eines ActionListeners \citep{goetz13}}
                \begin{lstlisting}
button.addActionListener(new ActionListener() {
    public void actionPerformed(ActionEvent e) {
        ui.dazzle(e.getModifiers());
    }
});
                \end{lstlisting}
            \end{block}
        \end{minipage}
    \end{center}

    \begin{itemize}
        \item Handhabung von \texttt{this} und anderen Bezeichnern
        \item Verwendung von lokalen non-\texttt{final} Variablen nicht möglich
    \end{itemize}
\end{frame}

\begin{frame}[fragile]{Handhabung von \texttt{this} und anderen Bezeichnern}
    \begin{center}
        \begin{minipage}[b]{0.75\textwidth}
            \begin{block}{Variablengültigkeit in \only<1->{anonymen Klassen}}
                \begin{onlyenv}<1-3>
                    \begin{lstlisting}
Runnable selfPrinter = new Runnable() {
    public void run() {
        // prints result of Object.toString()
        System.out.println(toString()); 
        System.out.println(this.toString());
        // prints "Hello World!"
        System.out.println(OuterClass.this.toString()); 
    }
}
@Override
public string toString() {
    return "Hello World!";
}
                    \end{lstlisting}                        
                \end{onlyenv}
                \begin{onlyenv}<4->
                    \begin{lstlisting}
Runnable selfPrinter = () -> {
    // prints "Hello World!"
    System.out.println(toString()); 
    System.out.println(this.toString()); 
    System.out.println(OuterClass.this.toString()); 
}
@Override
public string toString() {
    return "Hello World";
}
                    \end{lstlisting}                        
                \end{onlyenv}
            \end{block}
        \end{minipage}
    \end{center}

    \begin{itemize}
        \item<2-> Ungewollte Überlagerung von Methoden durch Vererbung
        \only<4->{\\ \textcolor<4>{dkred!70}{$\rightarrow$ keine vererbten Bezeichner 
        von Supertypen}}
        \item<3-> Unqualifizierter Aufruf von \texttt{this} referenziert innere Klasse 
        \only<5->{\\ \textcolor<5>{dkred!70}{$\rightarrow$ \textbf{Lexikalisches Scoping:} 
        Referenzen haben die selbe Bedeutung wie außerhalb des Lambda-Ausdrucks}}
    \end{itemize}
\end{frame}


\begin{frame}[fragile]{Lokale non-\texttt{final} Variablen}
    \begin{center}
        \begin{minipage}[b]{0.75\textwidth}
            \begin{block}{Effektiv \texttt{final} Variable \citep{goetz13}}                
                \begin{onlyenv}<1-2>
                    \begin{lstlisting}
public Callable<String> helloCallable(String name) {
    String hello = "Hello";
    return new Callable<String>() {
        public String call() {
            return hello + ", " + name; // ERROR!
        }
    }
}
                    \end{lstlisting}                    
                \end{onlyenv}                    
                \begin{onlyenv}<3->
                    \begin{lstlisting}
public Callable<String> helloCallable(String name) {
    String hello = "Hello";
    return () -> (hello + ", " + name); // no error
}
                    \end{lstlisting}                    
                \end{onlyenv}
            \end{block}
        \end{minipage}
    \end{center}   

    \begin{itemize}
        \item<2-> Verwendung von lokalen non-\texttt{final} Variablen nicht erlaubt   
        \pause
        \textcolor<3>{dkred!70}{ \\$\rightarrow$ Relaxierung der Einschränkungen für \enquote{effektiv} \texttt{final} Variablen}
        \item<4-> \textbf{Aber:} Veränderbare Variablen sind weiterhin nicht erlaubt
    \end{itemize}

\end{frame}

\begin{frame}[fragile]{Veränderbare lokale Variablen und Lambda-Ausdrücke}
    \begin{center}
        \begin{minipage}[b]{0.75\textwidth}
            \begin{block}{Veränderung lokaler Variablen in Lambda-Ausdrücken \citep{goetz13}}                
                \begin{lstlisting}
int sum = 0;
list.forEach(e -> { sum += e.size(); }); // ERROR
                \end{lstlisting}    
            \end{block}
        \end{minipage}
    \end{center}   

    \begin{itemize}
        \item<2-> \textbf{Problem:} Ausdruck grundlegend seriell $\rightarrow$ problematisch 
        im Bezug auf Race-Konditionen
        \item<3-> \textbf{Alternative:} Behandle Problem als Reduktion
    \end{itemize}
    \begin{onlyenv}<3->
        \begin{center}
            \begin{minipage}[b]{0.75\textwidth}
                \begin{block}{Reduktion mit \texttt{java.util.stream} \citep{goetz13}}                
                    \begin{lstlisting}
int sum = list.stream()
                .mapToInt(e -> e.size())
                .reduce(0, (x,y) -> x+y);
                    \end{lstlisting}        
                \end{block}
            \end{minipage}
        \end{center}
    \end{onlyenv}   

\end{frame}